'OSPF

AD
IBGP 200
EIGRP redistributed 170
ODR 160
RIP 120
OSPF 110
EIGRP 90
EBGP 20
EIGRP summary 5

To form an OSPF adjacency, some attributes must match between neighbors, while others must be unique. 
The common attributes that must match are the area number, timers, authentication, stub flags, MTU, 
and compatible network types. 
The attributes that must be unique are the interface IP addresses and the router-ids. 
The router-id is a 32-bit number and is chosen first based on the process-level router-id command, 
second based on the highest active Loopback IP interface, and last based on the highest active non-Loopback interface IP address. 
Because the LSA origination is based on the router-id, each router needs a unique OSPF router-id within the OSPF domain; Two routers with the same router-id cannot become neighbors.

LSA types:
LSA are usually flooded every 30 min to avoid they age out (1 hour)
Flood reduction (per interface) will set the flag DoNotAge in the LSA and flood is not done anymore
1  - router LSA: contains router id and its links
2  - Network Link LSA sent by DR in Broadcast Media
     The LSA describes the DR and the atteched neighbours in the segment
     If the DR receives a type 3, it alsso replicates it and sends it to the other routers in the segment
     Note that the value of the next hop in the Type3 LSA does not change (io.e. it is the router that generated
     the type3 LSA)
3  - Network Summary LSA sent by Area Border Router (ABR) 
     An ABR connects to area 0 and another area and it sends
       - LSA from other Areas into Area0
       - LSA from Area0 into other Areas
    Note: if a router is not connected to area0 but to other areas it will not share
          the information between the areas    
4 - ASBR: send information about the AS Border Routers, it is generated by an ABR when they receive a type 5
          for a router in their area; The ABR knows about the exist point in the same area via Type-1
5 - External routes - generated by ASBR and flooded unchanged
                      type 1 (fixed changes including cost to asbr) and type 2 (metric fixed by asbr)  
                      Also generated as conversion from a type-7
                      They can have a forward address (if converted from type-7) but it can also be suppressed
7 - NSSA External - similar to Type-5 but generated in a NSSA area; it is translated to type-5 by ABR
                    when entering area 0                         

Timers on interface
hello, wait, dead
hello is self explanatory
wait time is always equal to dead timer and not directly configurable
     if after wait time, the router does not receive any hello packet
     it will declare itself as the DR
dead: time after which a neighbor is dead (DR/BDR re-election can happen)     
on demand circuit can have hello suppressed and LSA set with do not age flag

Network type BROADCAST
a DR and BDR are elected, routers go FULL state with DR/BDR
routers go 2-WAY with other routes (meaning they see each other but do not exchange info)
Note DR/BDR election is non pre-emptive; priority is set to zero to avoid taking part to the election process
- hello packets are multicast


=============

Network type NON-BROADCAST
a DR and BDR are elected, routers go FULL state with DR/BDR
- this is still a multiple access network but broadcast is not supported (e.g. dmvpn)
- it will still have DR/BDR election because it is mutliple access and DR must be on the hub
(so priority is set to 0 on the spokes)
- use the command on the interface to activate
- use the neighbor command under the process for peering 
- hello packets are unicast

Network type POINT-TO-POINT
- No DR/BDR election (because only 2 routers in the segment, broadcast is supported 
  This is the default for tunnel and other pont-2-point interfaces
- hello is multicast  
- used for Loopbacks (to advertise the actual mask)


Network type POINT-TO-MULTIPOINT
- No DR/BDR election
- hello are multicast
- neighbors go up to FULL state
- next hop in LSA3 changes to the ip of the hub router (it was not changed before)
  (all routes learned by the hub?)
- support cost per niehgbor

Network type POINT-TO-MULTIPOINT NON BROADCAST
- No DR/BDR election
- hello are unicast
- support cost per niehgbor

===============
Features:
- auto-cost reference-bandwidth <X> -> change the reference of cost of an interface
- interface cost can be set: ip ospf cost <X>

== Path selection
- SPF is only calculated intra-area
- ABR are trusted for external area calculations (exception E2/N2)
  The cost to a summary nework (type3 LSA) is the cost computed by the ABR
  plus the cost to reach the ABR
- Note when a node goes down, LSA will stay in the DB until their aging timer but
  the router will be declared down after the dead time.. so its LSA will not be used
- transit through a non backbone area can be enabled/disabled with: capability transit/no capability transit
  if enabled, non backbone areas can be used for transit if they have better cost  

=== VIRTUAL LINKS
- An OSPF virtual-link allows the creation of an indirect area 0 adjacency. 
- The IP specified in the virtual link command is the router id
  The neighbors forming adjacency over the virtual-link do not have to be directly connected; 
- does not support periodic hello, if authentication is enabled, clear the process to refresh  


=== Summarization, Filters and default routing 
INTER AREA
Because all goes through area0 it makes sense to make summary from other areas into area 0
command: area <source> range <summary> <mask>
If you have more than one entry point to area 0 you can summarize in one and keep the longest match
in the other one; longest match will be chosen no matter the metrics, summary will be used as backup
- the null0 route is usally created but it can be disabled with: no discard-route <internal/external>
EXTERNAL
It can be done only in ASBR routers
command: summary-address <summary> <mask>
creates LSA Type 5 External Type 1 
FILTER-LIST (type-3)
- only between areas
- can be applied with prefix-list
- you can specify an area and a direction eg. area <ID> filter-list prefix <p_list> <in/out>
DISTRIBUTE-LIST:
- used distribute list to filter intra area routes 
- can use route-maps
- inbound (router process)
FILTER WITH AD:
- set to 255 to discard the route from being installed
- command: distance <distance> <source> <mask> <acl with prefixes to match>
  = soruce needs to match the router id of the src
DATABASE FILTER-ALL
- similar to passive-inerface
- discard all the LSA to a neighbor or out an interface
- Hello packets still sent (but no LSA)
MAX-METRIC
- command: max-metric router-lsa
- used to isolate a router (for maintenance for instance) 
- option to use on-startup wait-for-bgp to wait for bgp convergence   
DEFAULT-ROUTE
- stub/nssa: no-summary generates  type-3 default
- nssa: default infor originate type-5 default
- default-inforamtion originate : 
     -> generates a type-5 (a default must be present)
     -> if the keyword always is used, the default route is not required anymore
     -> conditional matching a prefix-list in a route-map
        -> note that the prefix can match a static route with a track (reliable conditional)

=== Areas
Flags need to match in all routers of the same area
Stub         : command: area <X> stub -> removes Type-5 LSA and replace them with a default route. 
Totally Stub : command: area <X> stub no-summary 
              -> removes Type-5 / Type-3 LSA and replace them with a default route. 
              -> the no summary is only required in the ABR with area 0
Not-So-Stubby: command: area <X> nssa
               -> allows for the redistribution of external routes as Type-7          
               -> default route is not automatically generated
                 -> you can generate a default with area <X> nssa default-information-originate
               ->  if multiple ABR connect the NSSA area to area0 the ABR with highest router id
                   becomes the only router translating Type7 to type5 LSA
               -> if the ABR is also the ASBR, routes are generated as type-5 in ara0 and type-7 in the NSSA
                  the type-7 may not be required (if there is a default) so it can be suppressed    
                  area <X> nssa no-redistribution no-summary
Not-so-totally-stubby: combination of the totally-stubby area and the NSSA. 
                       Like the totally-stubby area, Type-3,Type-4,Type-5 are removed 
                       and replaced with a Type- 3 Summary LSA default route. 
                       Type-7 NSSA External LSAs are allowed to be originated inside the area.    

Note: you can have areas with no-summary (type-3 LSA default route) 
and default-information-originate (type-5 LSA default route) to control the exit point                                
    
TIMERS & MISC
- if hello are required more than one per second:  ip ospf dead-interval minimal hello-multiplier 4
- timers are based on interface type
- need to match and can be set manually
   ip ospf hello-interval 5
   ip ospf dead-interval 7    
- global timers control ospf process; pacing, retransmission, throttle,etc..
- Number of max LSA (and redistributed routes ) can be fixed
- MTU should match between neighbour but check can be disabled
- Multicast OSPF (type6) can be ignored    